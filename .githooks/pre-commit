#!/bin/sh
# Pre-commit Hook: Validiert Test-Inventar und Dokumentation
# Installation: git config core.hooksPath .githooks

echo "üîç Pre-commit Check: Test-Dokumentation"
echo ""

# Pr√ºfe ob test-inventory.yaml ge√§ndert wurde
if git diff --cached --name-only | grep -q "test-inventory.yaml"; then
    echo "üìù test-inventory.yaml wurde ge√§ndert - validiere..."

    # Validiere YAML-Syntax
    python -c "import yaml; yaml.safe_load(open('test-inventory.yaml', encoding='utf-8'))" 2>/dev/null
    if [ $? -ne 0 ]; then
        echo "‚ùå FEHLER: test-inventory.yaml hat ung√ºltige YAML-Syntax"
        exit 1
    fi

    # Validiere Inventar
    python scripts/sync_test_documentation.py --check
    if [ $? -ne 0 ]; then
        echo ""
        echo "‚ùå COMMIT ABGELEHNT: Test-Inventar ist inkonsistent"
        echo ""
        echo "Bitte beheben Sie die Fehler in test-inventory.yaml"
        echo "Oder f√ºhren Sie aus: python scripts/sync_test_documentation.py"
        exit 1
    fi

    echo "‚úì Test-Inventar validiert"
    echo ""
    echo "‚ö†Ô∏è  WICHTIG: Haben Sie die Dokumentation aktualisiert?"
    echo "    F√ºhren Sie aus: python scripts/sync_test_documentation.py"
    echo ""
fi

# Pr√ºfe ob Test-Dateien ge√§ndert wurden
if git diff --cached --name-only | grep -q "playwright_tests/tests/"; then
    echo "üìù Test-Dateien wurden ge√§ndert"
    echo "‚ö†Ô∏è  ERINNERUNG: test-inventory.yaml aktualisieren, falls neue Tests hinzugef√ºgt wurden"
    echo ""
fi

echo "‚úì Pre-commit Checks abgeschlossen"
exit 0
